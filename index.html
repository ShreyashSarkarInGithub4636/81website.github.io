<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload .pkg File</title>
    <style>
        /* Style for the error message box */
        .error-box {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 16px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            margin-left: 5%;
        }
         body { font-family: sans-serif; margin: 20px; }
        #content-area { margin-top: 20px; border: 1px solid #ccc; padding: 10px;}
        pre { background-color: #f4f4f4; padding: 10px; overflow-x: auto; position: relative; }
        pre button { position: absolute; top: 5px; right: 5px; background-color: #ddd; border: none; padding: 5px 8px; cursor: pointer; font-size: 0.8em; }
         pre button:hover { background-color: #ccc; }
        #console {
            background-color: #222;
            color: #fff;
            padding: 10px;
            margin-top: 20px;
            height: 200px;
            overflow-y: scroll;
            font-family: monospace;
             white-space: pre-wrap; /* Keep text in the same line */
        }
    </style>
</head>
<body>
    <h1>Upload Your .pkg File</h1>
    <form id="uploadForm">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
        <br><br>
        <label for="pkgFile">Select .pkg file:</label>
        <input type="file" id="pkgFile" name="pkgFile" accept=".pkg" required>
        <br><br>
        <button type="submit">Upload</button>
    </form>
   <br>
    <button id="loadPkgGuide">Show Package Creation Guide</button>
   <div id="content-area"></div>
     <div id="console"></div>
   <script>
         document.getElementById("loadPkgGuide").addEventListener("click", function() {
             fetch("81manpkg.html")
                .then(response => response.text())
                .then(data => {
                   document.getElementById("content-area").innerHTML = data;
                 })
             .catch(error => console.error("Error fetching the package guide:", error));
          });
    </script>
     <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
     <script>
           // EmailJS Initialization
            (function(){
               emailjs.init("ZDNmcF0bh6MxjlDxZ"); // Your EmailJS user ID
            })();

        // Function to log messages to the console
      function logToConsole(message) {
        const consoleDiv = document.getElementById('console');
          const logEntry = document.createElement('div');
        logEntry.textContent = message;
        consoleDiv.appendChild(logEntry);
         // Scroll to bottom of the log
         consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

      // Override the console.log function to redirect output to the custom console
      const originalConsoleLog = console.log;
         console.log = function(message) {
             originalConsoleLog.apply(console, arguments); // Keep default console logging
              logToConsole(message);  // Send message to web console.
        };
        // JavaScript for handling file upload and scanning with VirusTotal and sending via email
        document.getElementById("uploadForm").addEventListener("submit", async (event) => {
            event.preventDefault();

            const email = document.getElementById("email").value;
            const fileInput = document.getElementById("pkgFile");
            const file = fileInput.files[0];

            if (!file) {
                alert("Please select a .pkg file to upload.");
                return;
            }

            if (file.type !== "" && !file.name.endsWith(".pkg")) {
                alert("Only .pkg files are allowed.");
                return;
            }

            try {
                 // Prepare the form data for scanning
                 const formData = new FormData();
                 formData.append("file", file);

                // Send the file to VirusTotal API for scanning
               const scanResponse = await fetch("https://www.virustotal.com/api/v3/files", {
                   method: "POST",
                    headers: {
                         "x-apikey": "006aae5c171e351c3a51056e4330136d38812efc6ad13e4d4e45abfee2b9be2a"
                    },
                    body: formData
                });
                const scanResult = await scanResponse.json();
                console.log("Virustotal response:", scanResult);

               // Check if the scan was successful
                if (!scanResult.data || !scanResult.data.attributes) {
                   showErrorMessage("File failed the scan. Scan results: " + JSON.stringify(scanResult));
                   return;
                }

               // Send the email using EmailJS
                emailjs.send("service_atf8nfq", "template_g2u8qaz", {
                  to_email: "shreyashmotunew@gmail.com",
                     from_email: email,
                      file_name: file.name,
                    file_content: file
                 })
                 .then(function() {
                       console.log("Email sent successfully");
                      alert("File uploaded successfully and sent to email!");
                   }, function(error) {
                        showErrorMessage("Email send failed. Error: " + JSON.stringify(error));
                         console.log("Email failed", error);
                    });


            } catch (error) {
                console.error("Error:", error);
                showErrorMessage("An error occurred during the process. Please try again.");
                console.log("Upload process failed", error);

            }
        });

        // Function to show error messages in a styled error box
        function showErrorMessage(message) {
            const errorBox = document.createElement("div");
            errorBox.classList.add("error-box");
            errorBox.textContent = message;

           // Append the error box to the body or a specific container
            document.body.appendChild(errorBox);

           // Automatically remove the error box after a few seconds
            setTimeout(() => {
                errorBox.remove();
           }, 5000);
        }
    </script>
 <script>
          function copyCode(elementId, button) {
            const codeElement = document.getElementById(elementId);
            const codeText = codeElement.innerText;

              navigator.clipboard.writeText(codeText)
                .then(() => {
                   button.textContent = 'Copied!';
                   setTimeout(() => {
                      button.textContent = 'Copy';
                      }, 2000);
                  })
             .catch(err => console.error('Failed to copy code:', err));
              }
      </script>
</body>
</html>
